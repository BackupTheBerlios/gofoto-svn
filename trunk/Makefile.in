# Build a Makefile.in modelled on Makefile.in generated by automake!
#
# Currently working on dist.  distdir is done.

SHELL = @SHELL@

srcdir          = @srcdir@
top_srcdir      = @top_srcdir@
prefix		= @prefix@
exec_prefix	= ${DESTDIR}/@exec_prefix@
bindir 		= @bindir@
datadir		= ${DESTDIR}/@datadir@/@PACKAGE@
INSTALL		= @INSTALL@
sharedir        = ${DESTDIR}/${prefix}/share/@PACKAGE@
mandir		= ${DESTDIR}/${prefix}/share/man/man1
etcdir          = ${DESTDIR}/@sysconfdir@
#etcdir          = /etc

pluginsdir      = ${datadir}/plugins

top_builddir = .

PACKAGE = @PACKAGE@
VERSION = @VERSION@

SUBDIRS = src plugins/PhotoRefining plugins/WebGallery plugins/VideoCD

EXTRA_DIST =    gofoto.sh.in gofoto.1

DIST_COMMON =  README COPYING ChangeLog INSTALL Makefile.in NEWS \
               configure configure.in install-sh py-compile

DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)

@SET_MAKE@

TAR = tar
GZIP_ENV = --best

all:
	for dir in $(SUBDIRS); do ${MAKE} -C $$dir all; done

install: all
	for dir in $(SUBDIRS); do ${MAKE} -C $$dir install; done
	-${INSTALL} -d ${bindir}
	${INSTALL} $(PACKAGE).sh ${bindir}/$(PACKAGE)
	-${INSTALL} -d ${mandir}
	${INSTALL} -m 644 $(PACKAGE).1 ${mandir}/$(PACKAGE).1
	chmod +x ${bindir}/$(PACKAGE)

uninstall:
	(cd src; ${MAKE} uninstall)
	rm ${bindir}/$(PACKAGE)
	rm ${mandir}/$(PACKAGE).1

distdir = $(PACKAGE)-$(VERSION)
top_distdir = $(distdir)

dist: distdir
	-chmod -R a+r $(distdir)
	GZIP=$(GZIP_ENV) $(TAR) chozf $(distdir).tar.gz $(distdir)
	-rm -rf $(distdir)

distdir: $(DISTFILES)
	-rm -rf $(distdir)
	mkdir $(distdir)
	-chmod 777 $(distdir)
	here=`cd $(top_builddir) && pwd`; \
	top_distdir=`cd $(distdir) && pwd`; \
	distdir=`cd $(distdir) && pwd`; \
	for file in $(DISTFILES); do \
	  d=$(srcdir); \
	  if test -d $$d/$$file; then \
	    cp -pr $$d/$$file $(distdir)/$$file; \
	  else \
	    test -f $(distdir)/$$file \
	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
	    || cp -p $$d/$$file $(distdir)/$$file || :; \
	  fi; \
	done
	for subdir in $(SUBDIRS); do \
	  if test "$$subdir" = .; then :; else \
	    test -d $(distdir)/$$subdir \
	    || mkdir -p $(distdir)/$$subdir \
	    || exit 1; \
	    chmod 777 $(distdir)/$$subdir; \
	    (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) distdir=$(distdir)/$$subdir distdir) \
	      || exit 1; \
	  fi; \
	done

debian:
	autoconf
	dpkg-buildpackage -rfakeroot

clean:
	(cd src; ${MAKE} clean)
	rm -f core *~ config.cache config.log config.status
	rm -rf autom4te.cache

realclean: clean
	rm -f configure gofoto.sh
	rm -f build-stamp configure-stamp
	rm -rf debian/gofoto

cvsclean: realclean
	(cd src; ${MAKE} cvsclean)
	rm -f Makefile gofoto-[0-9].[0-9].[0-9].tar.gz
	rm -rf gofoto-[0-9].[0-9].[0-9]
